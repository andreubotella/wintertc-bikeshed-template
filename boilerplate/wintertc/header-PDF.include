<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>[TITLE]</title>
  <meta name="author" content="Ecma International">
  <meta name="subject" content="[ECMA-STANDARD], [EDITION] / [DATE]">
  <link rel="stylesheet" href="../ecmarkup/css/elements.css">
  <link rel="stylesheet" href="../ecmarkup/css/print.css">
  <style>
    @prince-pdf {
      -prince-pdf-page-layout: two-column-right;
      -prince-pdf-page-mode: show-bookmarks;
      -prince-pdf-duplex: duplex-flip-long-edge;
    }

    #toc > h2#contents {
      content: "Contents";
    }

    #toc > ol > li:first-child {
      /* The introduction is not an entry in the TOC, so the first entry doesn't
       * need to be hidden. */
      display: list-item;
    }

    /* Similar to emu-note in Ecmarkup. We use float rather than flex. */
    .issue, .advisement, .assertion, .note {
      margin: 1em 0;
      /*display: flex;
      gap: 1em;
      flex-direction: row;*/
      border-left: 5px solid var(--note-border-color);
      background: var(--note-background-color);
      padding: 10px 10px 10px 0;
      overflow-x: auto;
    }
    :is(.issue, .advisement, .assertion, .note) > span.marker {
      display: block;
      float: left;
      white-space: nowrap;
      text-transform: uppercase;
      padding-left: 5px;
      margin-right: 1em;
    }
    .note {
      --note-background-color: #e9fbe9;
      --note-border-color: #52e052;
    }

    a:not([href]) {
      color: inherit;
    }

    /* Links generated by Bikeshed, other than local links (which include biblio refs), are annotated with the URL. */
    a[data-link-type][href]:not([href^="#"])::after {
        content: " <" attr(href) ">";
        color: initial;
        text-decoration: initial;
        white-space: pre-wrap;
        hyphens: initial;
    }
    /* In a linked-expr, only the final link has the URL annotated. */
    .linked-expr code.idl:not(:last-of-type) a::after {
        content: none;
    }
    /* Don't hyphenate biblio refs */
    a[data-link-type=biblio] {
        hyphens: initial;
    }

    /*
    // Ecmarkup:
    // <emu-note>
    //   <span class="note">Note</span>
    //   <div class="note-contents">[...]</div>
    // </emu-note>

    // Bikeshed:
    // <p class="note" role="note">
    //   <span class="marker">Note:</span>
    //   [...]
    // </p>
    // (issue, advisement, assertion, node)
    */
  </style>
  <script>
    // Ecmarkup fixes
    window.onload = () => {
      // replace data-fill-with that add nothing with their contents
      Array.from(document.querySelectorAll("[data-fill-with]")).forEach(dfw => {
        if (dfw.localName === "div" && dfw.attributes.length === 1) {
          // dfw.replaceWith(...dfw.childNodes);
          let currentChild = dfw.firstChild;
          while (currentChild) {
            let nextChild = currentChild.nextSibling;
            dfw.before(currentChild);
            currentChild = nextChild;
          }
          dfw.remove();
        }
      });

      // Secno vs secnum
      Array.from(document.querySelectorAll("#toc .secno")).forEach(secno => {
        if (secno.textContent === "") {
          secno.remove();
        } else {
          secno.classList.replace("secno", "secnum");
        }
      });

      // Inserting emu-clause
      {
        const specContainer = document.getElementById("spec-container");
        const fragment = document.createDocumentFragment();
        const emuClauseStack = [null, fragment];
        let section = "main";  // "main" | "annex" | "back-matter"
        const annexNum = [0, -1];
        let currentNode = specContainer.querySelector("h1.title").nextSibling;
        while (currentNode) {
          let nextNode = currentNode.nextSibling;
          if (currentNode instanceof Element && currentNode.classList.contains("heading")) {
            const level = parseInt(currentNode.tagName.slice(1));
            const emuClause = document.createElement(section === "main" ? "emu-clause" : "emu-annex");
            emuClause.id = currentNode.id;
            if (section === "back-matter") {
              emuClause.setAttribute("back-matter", "");
            }
            const heading = document.createElement("h1");
            if (currentNode.hasAttribute("data-level")) {
              const secnum = document.createElement("span");
              secnum.classList.add("secnum");
              secnum.textContent = currentNode.getAttribute("data-level");
              heading.appendChild(secnum);
            } else if (section === "annex") {
              // level 2: "Annex A (informative)"
              // level 3: "A.1"
              annexNum[level - 1] = (annexNum[level - 1] || 0) + 1;
              annexNum.length = level;
              const annexLetter = String.fromCharCode("A".charCodeAt() + annexNum[1]);
              const secnum = document.createElement("span");
              secnum.classList.add("secnum");
              if (level == 2) {
                secnum.textContent = `Annex ${annexLetter} `;
                const annexKind = document.createElement("span");
                annexKind.classList.add("annex-kind");
                annexKind.textContent = "(informative)";
                secnum.appendChild(annexKind);
              } else {
                secnum.textContent = annexLetter + annexNum.slice(2).map(n => `.${n}`).join("");
              }
              heading.appendChild(secnum);
              // Fix ToC
              const tocLink = document.querySelector(`#toc a[href="#${currentNode.id}"]`);
              tocLink.insertBefore(secnum.cloneNode(true), tocLink.firstChild);
            }
            heading.appendChild(document.createTextNode(" "));
            heading.appendChild(currentNode.querySelector(".content"));
            emuClause.appendChild(heading);
            currentNode.remove();
            emuClauseStack[level - 1].appendChild(emuClause);
            emuClauseStack[level] = emuClause;
            emuClauseStack.length = level + 1;
          } else if (currentNode instanceof Element && currentNode.localName == "hr" && currentNode.hasAttribute("bikeshed-ecmarkup-section")) {
            section = currentNode.getAttribute("bikeshed-ecmarkup-section");
            currentNode.remove();
          } else {
            emuClauseStack[emuClauseStack.length - 1].appendChild(currentNode);
          }
          currentNode = nextNode;
        }
        specContainer.appendChild(fragment);
      }
    };
  </script>
</head>
<body>
  <div class="full-page-svg" id="front-cover">
    <h1 class="shortname"><span class="status">[LONGSTATUS]</span> [ECMA-STANDARD]</h1>
    <h1 class="version" data-year="[YEAR]">[EDITION] / [DATE]</h1>
    <h1 class="title">[SPECTITLE]</h1>
  </div>
  <div class="full-page-svg" id="inside-cover"></div>
  <div id="spec-container">
    <div data-fill-with="table-of-contents" id="toc"></div>
    <emu-intro>
      <h1 class="no-num">Introduction</h1>
      <div data-fill-with="introduction"></div>
      <div id="metadata-block">
        <h1 class="no-num no-toc no-ref">Contributing to this Specification</h1>
        <div data-fill-with="spec-metadata"></div>
      </div>
    </emu-intro>

    <div id="copyright-notice" class="copyright-notice" data-fill-with="copyright"></div>

    <h1 class="title">[SPECTITLE]</h1>
